!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).vocaHttp={})}(this,(function(e){"use strict";function t(e,t,o,r){return new(o||(o=Promise))((function(n,s){function i(e){try{a(r.next(e))}catch(e){s(e)}}function c(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,c)}a((r=r.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const o=(e,{baseUrl:o="",onError:r=e=>Promise.reject(e),onRequest:n=e=>e,onRequestError:s=r,onResponse:i=e=>Promise.resolve(e),onResponseError:c=r,interceptors:a={request:[],response:[]},retryCount:u=3,timeout:h=5e3}={})=>(...r)=>{let d=0;const l=new AbortController,p=setTimeout((()=>l.abort()),h),f=o=>e(o.url,Object.assign(Object.assign({},o),{signal:l.signal})).then((e=>(a.response.forEach((t=>{const o=t(e);o&&(e=o)})),i(e)))).catch((e=>t(void 0,void 0,void 0,(function*(){return d<u&&"AbortError"!==e.name?(d+=1,console.log(`Retrying... Attempt ${d}`),f(o)):c(e)}))));try{let e=n(...r);return a.request.forEach((t=>{const o=t(e);o&&(e=o)})),e.url=`${o}${e.url}`,f(e).finally((()=>clearTimeout(p)))}catch(e){return s(e)}};class r{constructor(){this.httpMethods=["GET","POST","PUT","PATCH","DELETE"]}getEnv(){return"undefined"!=typeof window?window:"undefined"!=typeof global?global:globalThis}getHttpMethods(){return this.httpMethods}}function n(e,t){return new s(e,t).execute()}class s{constructor(e,t){this.method=null,this.base=new r,this.uri=e[1],this.data=e[2],this.vocaInstance=this._vocaItem(t),e.includes("GET")?this.method="GET":e.includes("POST")?this.method="POST":e.includes("PATCH")?this.method="PATCH":e.includes("PUT")?this.method="PUT":e.includes("DELETE")&&(this.method="DELETE")}execute(){return this.method?"GET"===this.method?this.vocaInstance(this.method,this.uri):this.vocaInstance(this.method,this.uri,this.data):Promise.reject(new Error("Invalid HTTP method"))}_vocaItem(e){return o(this.base.getEnv().fetch,Object.assign(Object.assign({},e),{onRequest:(e,t,o=void 0,r={})=>{let n,s=Object.assign({"Content-Type":"application/json"},r);return o instanceof FormData?(n=o,delete s["Content-Type"]):o&&(n=JSON.stringify(o)),{url:`${t}`,body:n,method:e,headers:s}},onResponse:e=>{if(403===e.status)throw new Error("Authorization error.");return e.json()},onError:()=>Promise.reject()}))}}class i{constructor(){this.interceptors={request:[],response:[]},this.timeout=5e3,this.retryCount=3}addRequestInterceptor(e){this.interceptors.request.push(e)}addResponseInterceptor(e){this.interceptors.response.push(e)}setTimeout(e){this.timeout=e}setRetryCount(e){this.retryCount=e}getConfig(){return{interceptors:this.interceptors,timeout:this.timeout,retryCount:this.retryCount}}}const c=(e,t)=>{if(e.lengthComputable){t(e.loaded/e.total*100)}},a=(e,t,o={},r)=>{const n=new FormData;return n.append("file",t),fetch(e,{method:"POST",body:n,headers:o}).then((e=>{if(!e.ok)throw new Error(`HTTP Error: ${e.status}`);return e.json()})).catch((e=>{throw console.error("Upload error:",e),e}))},u=(e,t={},o)=>fetch(e,{method:"GET",headers:t}).then((e=>{if(!e.ok)throw new Error(`HTTP Error: ${e.status}`);const t=e.headers.get("Content-Length"),r=t?parseInt(t,10):0;let n=0;if(o&&r&&e.body){const t=e.body;return new Response(new ReadableStream({start(e){const s=t.getReader();!function t(){s.read().then((({done:s,value:i})=>{s?e.close():(n+=i.length,o&&o(n/r*100),e.enqueue(i),t())})).catch((t=>{console.error("Download stream error:",t),e.error(t)}))}()}}))}return e})).then((e=>e.text())).catch((e=>{throw console.error("Download error:",e),e})),h={create:o,get:(...e)=>n(["GET",...e],(new i).getConfig()),post:(...e)=>n(["POST",...e],(new i).getConfig()),patch:(...e)=>n(["PATCH",...e],(new i).getConfig()),put:(...e)=>n(["PUT",...e],(new i).getConfig()),delete:(...e)=>n(["DELETE",...e],(new i).getConfig()),config:new i,trackProgress:c,uploadFile:a,downloadFile:u};e.HttpBase=r,e.VocaRequestConfig=i,e.downloadFile=u,e.trackProgress=c,e.uploadFile=a,e.voca=h,e.vocaCreate=o}));
//# sourceMappingURL=voca-http.umd.min.js.map
